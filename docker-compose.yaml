---
services:
  gitlab:
    container_name: gitlab
    image: gitlab/gitlab-ce:17.9.0-ce.0
    hostname: "gitlab.test"
    ports:
      - 80:80
      - 443:443
      - 22:22
    volumes:
      - ./config/:/etc/gitlab
      - ./logs/:/var/log/gitlab
      - ./data/:/var/opt/gitlab
    depends_on:
      - acme
    restart: unless-stopped

  acme:
    container_name: acme
    image: smallstep/step-ca:0.28.1
    hostname: "acme.test"
    environment:
      - DOCKER_STEPCA_INIT_NAME=acme.test
      - DOCKER_STEPCA_INIT_DNS_NAMES=localhost
    ports:
      - 9000:9000
    volumes:
      - ./step:/home/step
    restart: unless-stopped

#volumes:
#  step: {}